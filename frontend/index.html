<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InterviewIQ â€” AI Interview Prep</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0a0f;--bg2:#0d0d18;--bg3:#0f1020;--bg4:#131428;
  --cyan:#00d4ff;--blue:#0066ff;--purple:#6600ff;
  --txt:#e8f4ff;--txt2:#7a9bbe;--txt3:#3d5a78;
  --bdr:rgba(0,212,255,.15);--bdr2:rgba(0,212,255,.45);
  --ok:#00ff88;--warn:#ffaa00;--err:#ff4466;
  --ff:'Orbitron',monospace;--fb:'Inter',sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--txt);font-family:var(--fb);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(0,212,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.03) 1px,transparent 1px);
  background-size:50px 50px}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* HEADER */
header{position:sticky;top:0;z-index:100;background:rgba(10,10,15,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--bdr);padding:0 24px}
.hdr{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px}
.logo{display:flex;align-items:center;gap:12px;text-decoration:none}
.logo-icon{width:38px;height:38px;background:linear-gradient(135deg,var(--blue),var(--cyan));border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 0 18px rgba(0,102,255,.5)}
.logo-text{font-family:var(--ff);font-size:19px;font-weight:700;background:linear-gradient(135deg,var(--cyan),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:2px}
.logo-sub{font-size:9px;color:var(--txt3);letter-spacing:1px;font-family:var(--ff)}
.badge{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--txt2);font-family:var(--ff);letter-spacing:1px}
.dot{width:8px;height:8px;border-radius:50%;background:var(--ok);box-shadow:0 0 8px var(--ok);animation:pulse 2s infinite}

/* HERO */
.hero{position:relative;z-index:1;text-align:center;padding:52px 24px 32px}
.hero-eye{font-family:var(--ff);font-size:10px;letter-spacing:4px;color:var(--cyan);margin-bottom:16px;opacity:.8}
.hero h1{font-family:var(--ff);font-size:clamp(24px,5vw,54px);font-weight:900;line-height:1.1;background:linear-gradient(135deg,#fff 0%,var(--cyan) 50%,var(--blue) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:14px}
.hero p{font-size:15px;color:var(--txt2);max-width:520px;margin:0 auto 26px;line-height:1.7}
.hero-stats{display:flex;justify-content:center;gap:36px;flex-wrap:wrap}
.stat-n{font-family:var(--ff);font-size:20px;font-weight:700;color:var(--cyan)}
.stat-l{font-size:10px;color:var(--txt3);letter-spacing:1px;margin-top:2px}

/* TABS */
.tabs-wrap{position:relative;z-index:1;max-width:1200px;margin:0 auto;padding:0 20px 60px}
.tabs-nav{display:flex;gap:4px;background:var(--bg3);border:1px solid var(--bdr);border-radius:14px;padding:5px;margin-bottom:24px;overflow-x:auto;scrollbar-width:none}
.tabs-nav::-webkit-scrollbar{display:none}
.tab-btn{flex:1;min-width:120px;padding:11px 12px;background:transparent;border:1px solid transparent;border-radius:10px;color:var(--txt3);font-family:var(--fb);font-size:13px;font-weight:500;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:7px;white-space:nowrap}
.tab-btn:hover{color:var(--txt2);background:rgba(0,212,255,.05);border-color:var(--bdr)}
.tab-btn.active{background:linear-gradient(135deg,rgba(0,102,255,.2),rgba(0,212,255,.15));border-color:var(--bdr2);color:var(--cyan);box-shadow:0 0 20px rgba(0,212,255,.08)}
.tab-panel{display:none;animation:fadeUp .3s ease}
.tab-panel.active{display:block}

/* CARD */
.card{background:var(--bg3);border:1px solid var(--bdr);border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:border-color .3s;margin-bottom:18px}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--cyan),transparent);opacity:.35}
.card:hover{border-color:rgba(0,212,255,.28)}
.card-title{font-family:var(--ff);font-size:12px;font-weight:600;color:var(--cyan);letter-spacing:2px;margin-bottom:16px;display:flex;align-items:center;gap:8px}

/* FORM */
.fg{margin-bottom:16px}
.fl{display:block;font-size:11px;font-weight:600;color:var(--txt2);letter-spacing:1px;margin-bottom:6px;font-family:var(--ff)}
textarea,input[type=text]{width:100%;background:var(--bg2);border:1px solid var(--bdr);border-radius:9px;color:var(--txt);font-family:var(--fb);font-size:14px;line-height:1.6;padding:13px 15px;resize:vertical;transition:all .3s;outline:none}
textarea:focus,input[type=text]:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(0,212,255,.09);background:var(--bg4)}
textarea::placeholder,input::placeholder{color:var(--txt3)}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:8px;padding:12px 26px;border:none;border-radius:9px;font-family:var(--ff);font-size:11px;font-weight:600;letter-spacing:2px;cursor:pointer;transition:all .3s;text-transform:uppercase}
.btn-p{background:linear-gradient(135deg,var(--blue),var(--cyan));color:#fff;box-shadow:0 4px 18px rgba(0,102,255,.4)}
.btn-p:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,102,255,.55)}
.btn-s{background:transparent;color:var(--cyan);border:1px solid var(--bdr2)}
.btn-s:hover{background:rgba(0,212,255,.08);transform:translateY(-1px)}
.btn-d{background:linear-gradient(135deg,#550011,var(--err));color:#fff}
.btn-d:hover{transform:translateY(-2px)}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}

/* LOADER */
.loader-wrap{display:flex;flex-direction:column;align-items:center;gap:14px;padding:44px}
.loader{width:44px;height:44px;border:3px solid rgba(0,212,255,.1);border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite}
.loader-txt{font-family:var(--ff);font-size:10px;color:var(--cyan);letter-spacing:3px;animation:blink 1.4s ease-in-out infinite}

/* SKILL TAGS */
.skill-grid{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:18px}
.stag{padding:5px 13px;border-radius:20px;font-size:12px;font-weight:500;border:1px solid;transition:all .2s;cursor:default}
.stag.a{background:rgba(0,102,255,.1);border-color:rgba(0,102,255,.4);color:#6699ff}
.stag.b{background:rgba(0,212,255,.08);border-color:rgba(0,212,255,.3);color:var(--cyan)}
.stag.c{background:rgba(102,0,255,.1);border-color:rgba(102,0,255,.4);color:#aa66ff}
.stag:hover{transform:translateY(-1px)}

/* QUESTIONS */
.sec-hdr{font-family:var(--ff);font-size:10px;letter-spacing:3px;color:var(--cyan);margin-bottom:12px;padding-bottom:7px;border-bottom:1px solid var(--bdr);opacity:.8}
.qlist{list-style:none}
.qitem{background:var(--bg4);border:1px solid var(--bdr);border-radius:9px;padding:14px 18px;margin-bottom:9px;display:flex;gap:12px;align-items:flex-start;transition:all .3s;position:relative;overflow:hidden}
.qitem::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:linear-gradient(to bottom,var(--blue),var(--cyan))}
.qitem:hover{border-color:rgba(0,212,255,.28);transform:translateX(3px)}
.qnum{font-family:var(--ff);font-size:10px;color:var(--cyan);min-width:22px;margin-top:2px;font-weight:700}
.qtxt{flex:1;font-size:14px;line-height:1.6;color:var(--txt)}
.qcat{font-size:9px;padding:2px 7px;border-radius:4px;font-family:var(--ff);letter-spacing:1px;white-space:nowrap;align-self:flex-start;margin-top:2px}
.qcat.Technical{background:rgba(0,102,255,.2);color:#6699ff;border:1px solid rgba(0,102,255,.4)}
.qcat.Behavioral{background:rgba(102,0,255,.2);color:#aa66ff;border:1px solid rgba(102,0,255,.4)}
.qcat.Situational{background:rgba(0,180,90,.1);color:#00cc66;border:1px solid rgba(0,180,90,.3)}

/* SCORE RING */
.score-wrap{display:flex;align-items:center;gap:24px;padding:22px;background:var(--bg4);border:1px solid var(--bdr);border-radius:13px;margin-bottom:18px;flex-wrap:wrap}
.score-ring-c{position:relative;width:100px;height:100px;flex-shrink:0}
.score-ring-c svg{transform:rotate(-90deg);width:100px;height:100px}
.sr-bg{fill:none;stroke:rgba(0,212,255,.1);stroke-width:8}
.sr-fill{fill:none;stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset 1.2s ease}
.sr-num-wrap{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.sr-num{font-family:var(--ff);font-size:24px;font-weight:800}
.sr-lbl{font-size:9px;color:var(--txt3);letter-spacing:1px}
.score-meta{flex:1}
.score-title{font-family:var(--ff);font-size:17px;font-weight:700;margin-bottom:4px}
.score-sub{color:var(--txt2);font-size:13px;line-height:1.6}

.skill-cols{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}
.sc-title{font-family:var(--ff);font-size:10px;letter-spacing:2px;margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid}
.sc-title.ok{color:var(--ok);border-color:rgba(0,255,136,.3)}
.sc-title.bad{color:var(--err);border-color:rgba(255,68,102,.3)}
.spill{display:inline-flex;align-items:center;margin:3px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:500}
.spill.ok{background:rgba(0,255,136,.08);border:1px solid rgba(0,255,136,.3);color:var(--ok)}
.spill.bad{background:rgba(255,68,102,.08);border:1px solid rgba(255,68,102,.3);color:var(--err)}
.gap-item{background:var(--bg4);border:1px solid rgba(255,170,0,.2);border-left:3px solid var(--warn);border-radius:8px;padding:11px 15px;margin-bottom:9px}
.gap-area{font-family:var(--ff);font-size:9px;color:var(--warn);letter-spacing:1px;margin-bottom:3px}
.gap-desc{font-size:13px;color:var(--txt2)}
.rec-item{display:flex;align-items:flex-start;gap:9px;padding:8px 0;border-bottom:1px solid var(--bdr);font-size:13px;color:var(--txt2)}
.rec-item:last-child{border-bottom:none}
.rec-arr{color:var(--cyan);flex-shrink:0}

/* STUDY GUIDE */
.topic-card{background:var(--bg4);border:1px solid var(--bdr);border-radius:12px;overflow:hidden;margin-bottom:12px;transition:all .3s}
.topic-card:hover{border-color:rgba(0,212,255,.28);box-shadow:0 6px 20px rgba(0,0,0,.3)}
.topic-hdr{padding:14px 18px;display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none}
.tpri{padding:2px 9px;border-radius:20px;font-size:9px;font-family:var(--ff);letter-spacing:1px;font-weight:600}
.tpri.High{background:rgba(255,68,102,.15);border:1px solid rgba(255,68,102,.4);color:var(--err)}
.tpri.Medium{background:rgba(255,170,0,.1);border:1px solid rgba(255,170,0,.3);color:var(--warn)}
.tpri.Low{background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.3);color:var(--cyan)}
.tname{flex:1;font-weight:600;font-size:14px}
.ttime{font-size:10px;color:var(--txt3);font-family:var(--ff)}
.tchev{color:var(--txt3);transition:transform .3s;font-size:11px}
.topic-card.open .tchev{transform:rotate(180deg)}
.topic-body{display:none;padding:0 18px 18px;border-top:1px solid var(--bdr)}
.topic-card.open .topic-body{display:block}
.tsec{font-family:var(--ff);font-size:9px;letter-spacing:2px;color:var(--txt3);margin:10px 0 6px}
.ctag{display:inline-block;margin:2px;background:rgba(0,102,255,.1);border:1px solid rgba(0,102,255,.3);color:#7799ff;padding:3px 10px;border-radius:5px;font-size:12px}
.ritem{display:flex;align-items:center;gap:7px;padding:4px 0;font-size:13px;color:var(--txt2)}
.ritem::before{content:'âš¡';font-size:11px}
.tq{font-size:13px;color:var(--txt2);padding:4px 0;display:flex;gap:7px}
.tq::before{content:'â€º';color:var(--cyan);font-size:15px;line-height:1.2;flex-shrink:0}

/* MOCK INTERVIEW */
.mock-arena{display:none}
.mock-arena.active{display:block}
.ibar{background:var(--bg4);border:1px solid var(--bdr);border-radius:9px;padding:11px 18px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.pdots{display:flex;gap:5px}
.pdot{width:8px;height:8px;border-radius:50%;background:var(--bg3);border:1px solid var(--bdr);transition:all .3s}
.pdot.done{background:var(--ok);border-color:var(--ok);box-shadow:0 0 5px var(--ok)}
.pdot.cur{background:var(--cyan);border-color:var(--cyan);box-shadow:0 0 5px var(--cyan);animation:pulse 1.5s infinite}
.q-display{background:var(--bg4);border:1px solid var(--bdr2);border-radius:13px;padding:24px;margin-bottom:16px;box-shadow:0 0 24px rgba(0,212,255,.04)}
.q-lbl{font-family:var(--ff);font-size:9px;letter-spacing:3px;color:var(--txt3);margin-bottom:12px;display:flex;align-items:center;gap:9px}
.qbadge{padding:2px 7px;border-radius:4px;font-size:8px;background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.3);color:var(--cyan)}
.q-text-main{font-size:16px;line-height:1.7;color:var(--txt);font-weight:500}
.fb-card{background:var(--bg4);border:1px solid var(--bdr);border-radius:12px;padding:18px;margin-bottom:14px;border-left:3px solid var(--cyan);animation:fadeUp .4s ease}
.fb-hdr{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.fb-score-c{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--ff);font-size:14px;font-weight:800;flex-shrink:0}
.fb-title{font-family:var(--ff);font-size:11px;letter-spacing:2px;color:var(--cyan)}
.fb-sub{font-size:11px;color:var(--txt3);margin-top:2px}
.fb-sec{font-family:var(--ff);font-size:9px;letter-spacing:2px;color:var(--txt3);margin:9px 0 5px}
.fb-item{font-size:13px;color:var(--txt2);padding:3px 0;display:flex;gap:7px;align-items:flex-start}
.fb-item.good::before{content:'âœ“';color:var(--ok);flex-shrink:0}
.fb-item.bad::before{content:'â–³';color:var(--warn);flex-shrink:0}
.fb-hint{background:rgba(0,212,255,.04);border:1px solid rgba(0,212,255,.12);border-radius:7px;padding:9px 13px;margin-top:9px;font-size:13px;color:var(--txt2);line-height:1.6}
.fb-hint strong{color:var(--cyan);font-family:var(--ff);font-size:9px;letter-spacing:1px;display:block;margin-bottom:3px}
.final-card{background:linear-gradient(135deg,rgba(0,102,255,.08),rgba(0,212,255,.04));border:1px solid var(--bdr2);border-radius:14px;padding:28px;text-align:center;animation:fadeUp .5s ease}
.final-title{font-family:var(--ff);font-size:14px;font-weight:700;color:var(--cyan);margin-bottom:7px;letter-spacing:2px}
.final-score{font-family:var(--ff);font-size:48px;font-weight:900;line-height:1}
.final-sub{color:var(--txt2);font-size:13px;margin:7px 0 22px}
.final-cols{display:grid;grid-template-columns:1fr 1fr;gap:14px;text-align:left;margin-bottom:18px}
.fcol-title{font-family:var(--ff);font-size:9px;letter-spacing:2px;margin-bottom:7px;padding-bottom:4px;border-bottom:1px solid}
.fcol-title.ok{color:var(--ok);border-color:rgba(0,255,136,.3)}
.fcol-title.bad{color:var(--warn);border-color:rgba(255,170,0,.3)}
.f-item{font-size:13px;color:var(--txt2);padding:3px 0;display:flex;gap:7px}
.f-item.ok::before{content:'âœ“';color:var(--ok);flex-shrink:0}
.f-item.bad::before{content:'â†’';color:var(--warn);flex-shrink:0}

.g2{display:grid;grid-template-columns:1fr 1fr;gap:18px}
@media(max-width:768px){
  .g2{grid-template-columns:1fr}
  .hero h1{font-size:24px}
  .tab-btn{min-width:90px;font-size:11px;padding:9px 7px}
  .hdr .badge{display:none}
  .skill-cols,.final-cols{grid-template-columns:1fr}
  .score-wrap{flex-direction:column}
}
</style>
</head>
<body>

<header>
  <div class="hdr">
    <a class="logo" href="#">
      <div class="logo-icon">âš¡</div>
      <div>
        <div class="logo-text">INTERVIEWIQ</div>
        <div class="logo-sub">AI INTERVIEW PREP SYSTEM</div>
      </div>
    </a>
    <div class="badge"><div class="dot"></div>JARVIS ONLINE</div>
  </div>
</header>

<div class="hero">
  <div class="hero-eye">â–¸ POWERED BY MINIMAX AI â€” YOUR PERSONAL INTERVIEW COACH</div>
  <h1>Ace Every Interview<br>With AI Precision</h1>
  <p>Analyze JDs, match your resume, build a study plan, and practice with a real AI interviewer â€” all in one command center.</p>
  <div class="hero-stats">
    <div><div class="stat-n">4</div><div class="stat-l">AI MODULES</div></div>
    <div><div class="stat-n">âˆ</div><div class="stat-l">MOCK SESSIONS</div></div>
    <div><div class="stat-n">100%</div><div class="stat-l">AI POWERED</div></div>
    <div><div class="stat-n">FREE</div><div class="stat-l">NO SIGN-UP</div></div>
  </div>
</div>

<div class="tabs-wrap">
  <div class="tabs-nav">
    <button class="tab-btn active" onclick="switchTab('jd')">ğŸ” JD Analyzer</button>
    <button class="tab-btn" onclick="switchTab('resume')">ğŸ“Š Resume Matcher</button>
    <button class="tab-btn" onclick="switchTab('prep')">ğŸ“š Interview Prep</button>
    <button class="tab-btn" onclick="switchTab('mock')">ğŸ¤– Mock Interview</button>
  </div>

  <!-- JD ANALYZER -->
  <div id="tab-jd" class="tab-panel active">
    <div class="g2">
      <div class="card">
        <div class="card-title">ğŸ” JD ANALYZER</div>
        <div class="fg">
          <label class="fl">JOB DESCRIPTION</label>
          <textarea id="jd-input" rows="16" placeholder="Paste the full job description here...&#10;&#10;Include role, responsibilities, requirements..."></textarea>
        </div>
        <button class="btn btn-p" onclick="analyzeJD()" id="jd-btn">âš¡ ANALYZE JD</button>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“‹ ANALYSIS RESULTS</div>
        <div id="jd-output">
          <div style="text-align:center;padding:56px 20px;color:var(--txt3)">
            <div style="font-size:44px;margin-bottom:14px">ğŸ¯</div>
            <div style="font-family:var(--ff);font-size:10px;letter-spacing:2px">PASTE A JD TO BEGIN</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- RESUME MATCHER -->
  <div id="tab-resume" class="tab-panel">
    <div class="g2">
      <div class="card">
        <div class="card-title">ğŸ“Š RESUME MATCHER</div>
        <div class="fg">
          <label class="fl">JOB DESCRIPTION</label>
          <textarea id="rm-jd" rows="7" placeholder="Paste the job description..."></textarea>
        </div>
        <div class="fg">
          <label class="fl">YOUR RESUME</label>
          <textarea id="rm-resume" rows="9" placeholder="Paste your resume content here...&#10;&#10;Work experience, skills, education, projects..."></textarea>
        </div>
        <button class="btn btn-p" onclick="matchResume()" id="rm-btn">ğŸ“Š ANALYZE MATCH</button>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ˆ MATCH ANALYSIS</div>
        <div id="rm-output">
          <div style="text-align:center;padding:56px 20px;color:var(--txt3)">
            <div style="font-size:44px;margin-bottom:14px">ğŸ“Š</div>
            <div style="font-family:var(--ff);font-size:10px;letter-spacing:2px">PASTE JD + RESUME TO ANALYZE</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- INTERVIEW PREP -->
  <div id="tab-prep" class="tab-panel">
    <div class="card" style="max-width:680px">
      <div class="card-title">ğŸ“š INTERVIEW PREP GENERATOR</div>
      <div class="fg">
        <label class="fl">JOB DESCRIPTION</label>
        <textarea id="prep-jd" rows="8" placeholder="Paste the job description to generate a personalized study plan..."></textarea>
      </div>
      <button class="btn btn-p" onclick="generatePrep()" id="prep-btn">ğŸ“š GENERATE STUDY PLAN</button>
    </div>
    <div id="prep-output"></div>
  </div>

  <!-- MOCK INTERVIEW -->
  <div id="tab-mock" class="tab-panel">
    <div id="mock-setup" class="card" style="max-width:680px">
      <div class="card-title">ğŸ¤– MOCK INTERVIEW</div>
      <div class="fg">
        <label class="fl">JOB DESCRIPTION (for context)</label>
        <textarea id="mock-jd" rows="7" placeholder="Paste the job description so I can ask relevant questions..."></textarea>
      </div>
      <div class="fg">
        <label class="fl">NUMBER OF QUESTIONS</label>
        <input type="text" id="mock-count" value="5" style="width:80px">
      </div>
      <button class="btn btn-p" onclick="startMock()" id="mock-start-btn">ğŸš€ START INTERVIEW</button>
    </div>
    <div id="mock-arena" class="mock-arena">
      <div class="ibar">
        <div style="font-family:var(--ff);font-size:10px;color:var(--cyan);letter-spacing:2px" id="mock-progress-label">QUESTION 1 OF 5</div>
        <div class="pdots" id="mock-dots"></div>
        <button class="btn btn-d" style="padding:7px 16px;font-size:9px" onclick="endMock()">â¹ END</button>
      </div>
      <div class="q-display">
        <div class="q-lbl">JARVIS INTERVIEWER <span class="qbadge" id="mock-q-type">TECHNICAL</span></div>
        <div class="q-text-main" id="mock-question">Loading question...</div>
      </div>
      <div id="mock-feedback-area"></div>
      <div class="card" id="mock-answer-card">
        <div class="card-title">ğŸ’¬ YOUR ANSWER</div>
        <div class="fg">
          <textarea id="mock-answer" rows="5" placeholder="Type your answer here...&#10;&#10;Take your time. Think out loud. Structure your response clearly."></textarea>
        </div>
        <div class="btn-row">
          <button class="btn btn-p" onclick="submitAnswer()" id="mock-submit-btn">âœ“ SUBMIT ANSWER</button>
          <button class="btn btn-s" onclick="skipQuestion()" id="mock-skip-btn">â­ SKIP</button>
        </div>
      </div>
      <div id="mock-final"></div>
    </div>
  </div>
</div>

<script>
const API = 'http://localhost:8000';

// ASYNC JOB HELPER â€” posts request, polls until done, returns data
async function apiCall(endpoint, payload) {
  const r = await fetch(API + endpoint, {
    method: 'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const { job_id } = await r.json();
  // Poll until done
  for (let i = 0; i < 120; i++) {
    await new Promise(res => setTimeout(res, 1000));
    const pr = await fetch(API + '/job/' + job_id);
    const job = await pr.json();
    if (job.status === 'done') return job.result;
    if (job.status === 'error') throw new Error(job.result?.error || 'Job failed');
  }
  throw new Error('Request timed out');
}

// TAB SWITCHING
function switchTab(id) {
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  event.currentTarget.classList.add('active');
}

// LOADER HTML
function loaderHTML(msg) {
  return `<div class="loader-wrap"><div class="loader"></div><div class="loader-txt">${msg}</div></div>`;
}

// SCORE RING
function scoreRing(score, color) {
  const r = 42, c = 2*Math.PI*r;
  const offset = c - (score/100)*c;
  const label = score >= 80 ? 'EXCELLENT' : score >= 60 ? 'GOOD' : score >= 40 ? 'FAIR' : 'NEEDS WORK';
  const textColor = score >= 80 ? 'var(--ok)' : score >= 60 ? 'var(--cyan)' : score >= 40 ? 'var(--warn)' : 'var(--err)';
  return `<div class="score-ring-c">
    <svg viewBox="0 0 100 100"><circle class="sr-bg" cx="50" cy="50" r="${r}"/><circle class="sr-fill" cx="50" cy="50" r="${r}" stroke="${textColor}" stroke-dasharray="${c}" stroke-dashoffset="${c}" style="--target:${offset}"/></svg>
    <div class="sr-num-wrap"><div class="sr-num" style="color:${textColor}">${score}%</div><div class="sr-lbl">${label}</div></div>
  </div>`;
}

function animateRings() {
  document.querySelectorAll('.sr-fill').forEach(el => {
    const t = el.style.getPropertyValue('--target');
    setTimeout(() => { el.style.strokeDashoffset = t; }, 100);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JD ANALYZER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function analyzeJD() {
  const jd = document.getElementById('jd-input').value.trim();
  if (!jd) { alert('Please paste a job description first.'); return; }
  const btn = document.getElementById('jd-btn');
  btn.disabled = true;
  document.getElementById('jd-output').innerHTML = loaderHTML('ANALYZING JD...');
  try {
    const data = await apiCall('/analyze-jd', {jd});
    renderJDResult(data);
  } catch(e) {
    document.getElementById('jd-output').innerHTML = `<div style="color:var(--err);padding:20px;font-family:var(--ff);font-size:12px">âš  ERROR: ${e.message}</div>`;
  }
  btn.disabled = false;
}

function renderJDResult(d) {
  const cats = ['a','b','c'];
  const skillsHTML = (d.required_skills||[]).map((s,i)=>`<span class="stag ${cats[i%3]}">${s}</span>`).join('');
  const topicsHTML = (d.study_topics||[]).map((s,i)=>`<span class="stag ${cats[(i+1)%3]}">${s}</span>`).join('');
  const qHTML = (d.interview_questions||[]).map((q,i)=>`
    <li class="qitem">
      <span class="qnum">${String(i+1).padStart(2,'0')}</span>
      <span class="qtxt">${q.question||q}</span>
      <span class="qcat ${q.category||'Technical'}">${q.category||'Technical'}</span>
    </li>`).join('');
  document.getElementById('jd-output').innerHTML = `
    <div style="animation:fadeUp .3s ease">
      <div class="sec-hdr">REQUIRED SKILLS</div>
      <div class="skill-grid">${skillsHTML}</div>
      <div class="sec-hdr">STUDY TOPICS</div>
      <div class="skill-grid">${topicsHTML}</div>
      <div class="sec-hdr">LIKELY INTERVIEW QUESTIONS</div>
      <ul class="qlist">${qHTML}</ul>
      ${d.role_summary ? `<div class="sec-hdr" style="margin-top:18px">ROLE SUMMARY</div><p style="font-size:13px;color:var(--txt2);line-height:1.7">${d.role_summary}</p>` : ''}
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESUME MATCHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function matchResume() {
  const jd = document.getElementById('rm-jd').value.trim();
  const resume = document.getElementById('rm-resume').value.trim();
  if (!jd || !resume) { alert('Please paste both JD and resume.'); return; }
  const btn = document.getElementById('rm-btn');
  btn.disabled = true;
  document.getElementById('rm-output').innerHTML = loaderHTML('ANALYZING MATCH...');
  try {
    const data = await apiCall('/match-resume', {jd, resume});
    renderResumeResult(data);
  } catch(e) {
    document.getElementById('rm-output').innerHTML = `<div style="color:var(--err);padding:20px;font-family:var(--ff);font-size:12px">âš  ERROR: ${e.message}</div>`;
  }
  btn.disabled = false;
}

function renderResumeResult(d) {
  const score = d.match_score || 0;
  const color = score >= 80 ? 'var(--ok)' : score >= 60 ? 'var(--cyan)' : score >= 40 ? 'var(--warn)' : 'var(--err)';
  const verdict = score >= 80 ? 'Strong Match' : score >= 60 ? 'Good Match' : score >= 40 ? 'Partial Match' : 'Weak Match';
  const matchedHTML = (d.matched_skills||[]).map(s=>`<span class="spill ok">âœ“ ${s}</span>`).join('');
  const missingHTML = (d.missing_skills||[]).map(s=>`<span class="spill bad">âœ— ${s}</span>`).join('');
  const gapsHTML = (d.gaps||[]).map(g=>`<div class="gap-item"><div class="gap-area">${g.area||'Gap'}</div><div class="gap-desc">${g.description||g}</div></div>`).join('');
  const recsHTML = (d.recommendations||[]).map(r=>`<div class="rec-item"><span class="rec-arr">â†’</span>${r}</div>`).join('');
  document.getElementById('rm-output').innerHTML = `
    <div style="animation:fadeUp .3s ease">
      <div class="score-wrap">
        ${scoreRing(score, color)}
        <div class="score-meta">
          <div class="score-title" style="color:${color}">${verdict}</div>
          <div class="score-sub">${d.summary || 'Analysis complete. See details below.'}</div>
        </div>
      </div>
      <div class="skill-cols">
        <div><div class="sc-title ok">âœ“ MATCHED SKILLS</div>${matchedHTML||'<span style="color:var(--txt3);font-size:12px">None detected</span>'}</div>
        <div><div class="sc-title bad">âœ— MISSING SKILLS</div>${missingHTML||'<span style="color:var(--txt3);font-size:12px">None detected</span>'}</div>
      </div>
      ${gapsHTML ? `<div class="sec-hdr">SKILL GAPS</div>${gapsHTML}` : ''}
      ${recsHTML ? `<div class="sec-hdr">RECOMMENDATIONS</div>${recsHTML}` : ''}
    </div>`;
  animateRings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTERVIEW PREP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generatePrep() {
  const jd = document.getElementById('prep-jd').value.trim();
  if (!jd) { alert('Please paste a job description first.'); return; }
  const btn = document.getElementById('prep-btn');
  btn.disabled = true;
  document.getElementById('prep-output').innerHTML = `<div class="card">${loaderHTML('GENERATING STUDY PLAN...')}</div>`;
  try {
    const data = await apiCall('/interview-prep', {jd});
    renderPrepResult(data);
  } catch(e) {
    document.getElementById('prep-output').innerHTML = `<div class="card" style="color:var(--err);font-family:var(--ff);font-size:12px">âš  ERROR: ${e.message}</div>`;
  }
  btn.disabled = false;
}

function renderPrepResult(d) {
  const topicsHTML = (d.topics||[]).map(t => {
    const conceptsHTML = (t.concepts||[]).map(c=>`<span class="ctag">${c}</span>`).join('');
    const resourcesHTML = (t.resources||[]).map(r=>`<div class="ritem">${r}</div>`).join('');
    const questionsHTML = (t.questions||[]).map(q=>`<div class="tq">${q}</div>`).join('');
    return `<div class="topic-card">
      <div class="topic-hdr" onclick="toggleTopic(this)">
        <span class="tpri ${t.priority||'Medium'}">${t.priority||'Medium'}</span>
        <span class="tname">${t.name}</span>
        <span class="ttime">${t.study_time||'2-3h'}</span>
        <span class="tchev">â–¼</span>
      </div>
      <div class="topic-body">
        ${t.description ? `<p style="font-size:13px;color:var(--txt2);line-height:1.6;margin:12px 0 10px">${t.description}</p>` : ''}
        ${conceptsHTML ? `<div class="tsec">KEY CONCEPTS</div>${conceptsHTML}` : ''}
        ${resourcesHTML ? `<div class="tsec">RESOURCES</div>${resourcesHTML}` : ''}
        ${questionsHTML ? `<div class="tsec">PRACTICE QUESTIONS</div><div style="background:var(--bg2);border-radius:7px;padding:9px">${questionsHTML}</div>` : ''}
      </div>
    </div>`;
  }).join('');

  const overallHTML = d.study_schedule ? `
    <div class="card" style="margin-bottom:16px">
      <div class="card-title">ğŸ“… STUDY SCHEDULE</div>
      <p style="font-size:13px;color:var(--txt2);line-height:1.7">${d.study_schedule}</p>
    </div>` : '';

  document.getElementById('prep-output').innerHTML = `
    <div style="animation:fadeUp .3s ease">
      ${overallHTML}
      <div class="sec-hdr">TOPIC-WISE STUDY PLAN</div>
      ${topicsHTML || '<div style="color:var(--txt3);padding:20px;font-family:var(--ff);font-size:11px">No topics generated.</div>'}
    </div>`;
}

function toggleTopic(hdr) {
  hdr.parentElement.classList.toggle('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOCK INTERVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let mockState = { jd:'', questions:[], currentIdx:0, answers:[], feedbacks:[], totalQ:5 };

async function startMock() {
  const jd = document.getElementById('mock-jd').value.trim();
  const count = parseInt(document.getElementById('mock-count').value) || 5;
  if (!jd) { alert('Please paste a job description first.'); return; }
  
  const btn = document.getElementById('mock-start-btn');
  btn.disabled = true; btn.textContent = 'INITIALIZING...';

  mockState = { jd, questions:[], currentIdx:0, answers:[], feedbacks:[], totalQ:count };
  
  try {
    const data = await apiCall('/mock-interview', { jd, previous_qa:[], user_answer:'', action:'start', total_questions:count });
    mockState.questions.push(data);
    document.getElementById('mock-setup').style.display = 'none';
    const arena = document.getElementById('mock-arena');
    arena.classList.add('active');
    renderMockDots();
    renderQuestion();
  } catch(e) {
    alert('Error: ' + e.message);
  }
  btn.disabled = false; btn.textContent = 'ğŸš€ START INTERVIEW';
}

function renderMockDots() {
  const dots = document.getElementById('mock-dots');
  dots.innerHTML = Array.from({length: mockState.totalQ}, (_,i) => {
    let cls = i < mockState.currentIdx ? 'done' : i === mockState.currentIdx ? 'cur' : '';
    return `<div class="pdot ${cls}"></div>`;
  }).join('');
  document.getElementById('mock-progress-label').textContent = `QUESTION ${mockState.currentIdx+1} OF ${mockState.totalQ}`;
}

function renderQuestion() {
  const q = mockState.questions[mockState.currentIdx];
  document.getElementById('mock-q-type').textContent = q.category || 'Technical';
  document.getElementById('mock-question').textContent = q.question || q.next_question || 'Loading...';
  document.getElementById('mock-answer').value = '';
  document.getElementById('mock-answer-card').style.display = 'block';
  document.getElementById('mock-final').innerHTML = '';
}

async function submitAnswer() {
  const answer = document.getElementById('mock-answer').value.trim();
  if (!answer) { alert('Please type your answer.'); return; }
  
  const btn = document.getElementById('mock-submit-btn');
  btn.disabled = true; btn.textContent = 'EVALUATING...';
  document.getElementById('mock-skip-btn').disabled = true;
  
  const currentQ = mockState.questions[mockState.currentIdx];
  mockState.answers.push({ question: currentQ.question || currentQ.next_question, answer });
  
  try {
    const isLast = mockState.currentIdx >= mockState.totalQ - 1;
    const action = isLast ? 'final' : 'next';
    const data = await apiCall('/mock-interview', {
      jd: mockState.jd,
      previous_qa: mockState.answers,
      user_answer: answer,
      action,
      total_questions: mockState.totalQ,
      question_number: mockState.currentIdx + 1
    });
    mockState.feedbacks.push(data.feedback);
    
    if (data.feedback) renderFeedback(data.feedback, answer);
    
    if (isLast || action === 'final') {
      setTimeout(() => renderFinal(data), 1200);
    } else {
      mockState.questions.push(data);
      mockState.currentIdx++;
      renderMockDots();
      setTimeout(() => renderQuestion(), 800);
    }
  } catch(e) {
    alert('Error: ' + e.message);
  }
  btn.disabled = false; btn.textContent = 'âœ“ SUBMIT ANSWER';
  document.getElementById('mock-skip-btn').disabled = false;
}

function skipQuestion() {
  mockState.answers.push({ question: mockState.questions[mockState.currentIdx]?.question || '', answer: '[Skipped]' });
  if (mockState.currentIdx >= mockState.totalQ - 1) {
    renderFinal({ overall_score: 50, strengths:[], improvements:['Skipped questions'] });
    return;
  }
  mockState.currentIdx++;
  apiCall('/mock-interview', { jd:mockState.jd, previous_qa:mockState.answers, user_answer:'', action:'next', total_questions:mockState.totalQ, question_number:mockState.currentIdx+1 })
  .then(data => {
    mockState.questions.push(data);
    renderMockDots();
    renderQuestion();
  }).catch(e => alert('Error: ' + e.message));
}

function renderFeedback(fb, answer) {
  const score = fb.score || 70;
  const scoreColor = score >= 80 ? 'var(--ok)' : score >= 60 ? 'var(--cyan)' : score >= 40 ? 'var(--warn)' : 'var(--err)';
  const goodHTML = (fb.good_points||[]).map(p=>`<div class="fb-item good">${p}</div>`).join('');
  const badHTML = (fb.improve_points||[]).map(p=>`<div class="fb-item bad">${p}</div>`).join('');
  const fbDiv = document.createElement('div');
  fbDiv.className = 'fb-card';
  fbDiv.innerHTML = `
    <div class="fb-hdr">
      <div class="fb-score-c" style="background:${scoreColor}22;border:2px solid ${scoreColor};color:${scoreColor}">${score}%</div>
      <div><div class="fb-title">ANSWER FEEDBACK</div><div class="fb-sub">${fb.verdict || 'Good attempt'}</div></div>
    </div>
    ${goodHTML ? `<div class="fb-sec">STRENGTHS</div>${goodHTML}` : ''}
    ${badHTML ? `<div class="fb-sec">IMPROVE</div>${badHTML}` : ''}
    ${fb.ideal_hint ? `<div class="fb-hint"><strong>ğŸ’¡ IDEAL APPROACH</strong>${fb.ideal_hint}</div>` : ''}`;
  document.getElementById('mock-feedback-area').appendChild(fbDiv);
}

function renderFinal(data) {
  document.getElementById('mock-answer-card').style.display = 'none';
  const score = data.overall_score || Math.round(mockState.feedbacks.reduce((a,f)=>a+(f?.score||70),0)/Math.max(mockState.feedbacks.length,1));
  const scoreColor = score >= 80 ? 'var(--ok)' : score >= 60 ? 'var(--cyan)' : score >= 40 ? 'var(--warn)' : 'var(--err)';
  const verdict = score >= 80 ? 'ğŸ† Outstanding Performance' : score >= 60 ? 'âœ… Good Performance' : score >= 40 ? 'âš ï¸ Needs Improvement' : 'ğŸ“š Keep Practicing';
  const strsHTML = (data.strengths||[]).map(s=>`<div class="f-item ok">${s}</div>`).join('');
  const impHTML = (data.improvements||[]).map(s=>`<div class="f-item bad">${s}</div>`).join('');
  document.getElementById('mock-final').innerHTML = `
    <div class="final-card">
      <div class="final-title">INTERVIEW COMPLETE</div>
      <div class="final-score" style="color:${scoreColor}">${score}%</div>
      <div class="final-sub">${verdict}</div>
      <div class="final-cols">
        <div><div class="fcol-title ok">STRENGTHS</div>${strsHTML||'<div class="f-item ok">Attempted all questions</div>'}</div>
        <div><div class="fcol-title bad">AREAS TO IMPROVE</div>${impHTML||'<div class="f-item bad">Keep practicing regularly</div>'}</div>
      </div>
      <div class="btn-row" style="justify-content:center">
        <button class="btn btn-p" onclick="location.reload()">ğŸ”„ NEW SESSION</button>
        <button class="btn btn-s" onclick="switchTabDirect('prep')">ğŸ“š STUDY PLAN</button>
      </div>
    </div>`;
}

function endMock() {
  if(confirm('End interview session?')) { document.getElementById('mock-arena').classList.remove('active'); document.getElementById('mock-setup').style.display='block'; }
}

function switchTabDirect(id) {
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  document.querySelectorAll('.tab-btn')[2].classList.add('active');
}
</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>
</body>
</html>
